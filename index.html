<!DOCTYPE html>
<html>
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css"
    />
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300&display=swap" rel="stylesheet">

    <title>With Me</title>
    <link rel="stylesheet" href="style.css" />
  </head>

  <body>
    <div class="title">
      With Me
    </div>
    <div class="subtitle">
      최소 배달비를 위한 배달 매칭 플랫폼
    </div>
    <div class="container">
    <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 g-3">
      <div
        type="button"
        class="card"
        data-bs-toggle="collapse"
        href="#subway"
        role="button"
        aria-expanded="false"
        aria-controls="subway"
        >
        <img src="subway.png" class="card-img-top">
        <div class="card-body">
          써브웨이
        </div>
      </div>
      <div
        type="button"
        class="card"
        data-bs-toggle="collapse"
        href="#bbq"
        role="button"
        aria-expanded="false"
        aria-controls="bbq"
      >
        <img src="bbq.jpg" class="card-img-top">
        <div class="card-body">
          BBQ
        </div>
      </div>
      <div
      type="button"
      class="card"
      data-bs-toggle="collapse"
      href="#bbq"
      role="button"
      aria-expanded="false"
      aria-controls="bbq"
      >
        <img src="bbq.jpg" class="card-img-top">
        <div class="card-body">
          BBQ
        </div>
      </div>
      <div
        type="button"
        class="card"
        data-bs-toggle="collapse"
        href="#bbq"
        role="button"
        aria-expanded="false"
        aria-controls="bbq"
      >
        <img src="bbq.jpg" class="card-img-top">
        <div class="card-body">
          BBQ
        </div>
      </div>
      <div
        type="button"
        class="card"
        data-bs-toggle="collapse"
        href="#bbq"
        role="button"
        aria-expanded="false"
        aria-controls="bbq"
      >
        <img src="bbq.jpg" class="card-img-top">
        <div class="card-body">
          BBQ
        </div>
      </div>
      <div
        type="button"
        class="card"
        data-bs-toggle="collapse"
        href="#bbq"
        role="button"
        aria-expanded="false"
        aria-controls="bbq"
      >
        <img src="bbq.jpg" class="card-img-top">
        <div class="card-body">
          BBQ
        </div>
      </div>
      <div
        type="button"
        class="card"
        data-bs-toggle="collapse"
        href="#bbq"
        role="button"
        aria-expanded="false"
        aria-controls="bbq"
      >
        <img src="bbq.jpg" class="card-img-top">
        <div class="card-body">
          BBQ
        </div>
      </div>
      <div
        type="button"
        class="card"
        data-bs-toggle="collapse"
        href="#bbq"
        role="button"
        aria-expanded="false"
        aria-controls="bbq"
      >
        <img src="bbq.jpg" class="card-img-top">
        <div class="card-body">
          BBQ
        </div>
      </div>
    </div>
  </div>
    <button
      type="button"
      class="btn btn-success write position-absolute end-0"
      data-bs-toggle="collapse"
      href="#writing"
      role="button"
      aria-expanded="false"
      aria-controls="writing"
    >
      글쓰기 <i class="bi bi-pencil"></i>
    </button>
    <button type="button" class="btn btn-light position-absolute end-0">
      내 글 <i class="bi bi-card-text"></i>
    </button>

    <!-- 게시글 -->
    <div class="collapse" id="subway">
      <div>
        <h3>써브웨이(최소주문금액: 11000원)</h3>
      </div>
      <button type="button" class="btn btn-light select">전체</button>
      <button type="button" class="btn btn-light select">명륜</button>
      <button type="button" class="btn btn-light select">율전</button>

      <table class="table table-borderless">
        <thead>
          <tr>
            <th scope="col">#</th>
            <th scope="col">주문시간</th>
            <th scope="col">필요금액</th>
            <th scope="col">수령장소</th>
            <th scope="col"></th>
          </tr>
        </thead>
        <tbody id="subway_tbody"></tbody>
      </table>
    </div>

    <div class="collapse" id="bbq">
      <div>
        <h3>BBQ(최소주문금액: 18000원)</h3>
      </div>
      <button type="button" class="btn btn-light select">전체</button>
      <button type="button" class="btn btn-light select">명륜</button>
      <button type="button" class="btn btn-light select">율전</button>

      <table class="table table-borderless">
        <thead>
          <tr>
            <th scope="col">#</th>
            <th scope="col">주문시간</th>
            <th scope="col">필요금액</th>
            <th scope="col">수령장소</th>
            <th scope="col"></th>
          </tr>
        </thead>
        <tbody id="bbq_tbody"></tbody>
      </table>
    </div>

    <!-- 글쓰기 -->
    <form class="row g-3 needs-validation collapse" id="writing" novalidate>
      <div class="col-md-3">
        <label for="ordered_store" class="form-label">주문 가게</label>
        <select class="form-select" id="ordered_store" required>
          <option selected disabled value="">선택</option>
          <option>써브웨이</option>
          <option>BBQ</option>
          <option>1</option>
          <option>1</option>
          <option>1</option>
          <option>1</option>
          <option>1</option>
          <option>1</option>
        </select>
        <div class="invalid-feedback">주문 가게를 선택하세요.</div>
      </div>
      <div class="col-md-3">
        <label for="ordered_time" class="form-label">주문 시간</label>
        <input type="text" class="form-control" id="ordered_time" required />
        <div class="invalid-feedback">
          본인이 배달을 주문한 시간을 입력하세요.
        </div>
      </div>
      <div class="col-md-4">
        <label for="ordered_money" class="form-label"
          >주문 가격 (숫자만 입력하세요)</label
        >
        <div class="input-group has-validation">
          <input
            type="text"
            class="form-control"
            id="ordered_money"
            aria-describedby="inputGroupPrepend"
            required
          />
          <div class="invalid-feedback">
            최소주문금액보다 낮은 금액을 입력하세요.
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <label for="ordered_location" class="form-label">주문 장소</label>
        <select class="form-select" id="ordered_location" required>
          <option selected disabled value="">선택</option>
          <option>명륜 정문</option>
          <option>명륜 K-하우스</option>
          <option>명륜 G-하우스</option>
          <option>명륜 후문</option>
          <option>율전 인관</option>
          <option>율전 의관</option>
          <option>율전 예관</option>
          <option>율전 지관</option>
        </select>
        <div class="invalid-feedback">주문 장소를 선택하세요.</div>
      </div>
      <div class="col-md-7">
        <label for="validationCustomUsername" class="form-label">남길 말</label>
        <div class="input-group">
          <input
            type="text"
            class="form-control"
            id="etc"
            aria-describedby="inputGroupPrepend"
          />
        </div>
      </div>
      <div class="col-12">
        <div class="form-check">
          <input
            class="form-check-input"
            type="checkbox"
            value=""
            id="invalidCheck"
            required
          />
          <label class="form-check-label" for="invalidCheck">
            개인정보 공유 동의 (필수)
          </label>
          <div class="invalid-feedback">동의란에 체크하셔야 합니다.</div>
        </div>
      </div>
      <div class="col-12">
        <button
          class="btn btn-primary position-absolute start-25 submit"
          type="submit"
          id="submit"
        >
          제출
        </button>
      </div>
    </form>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf"
      crossorigin="anonymous"
    ></script>

    <script>
      const type = {
        Subway: 0,
        BBQ: 1,
      };
      let saves = [];
      window.addEventListener("load", () => {
        loaddata();
      });
      function savedata() {
        localStorage.setItem("saves", JSON.stringify(saves));
      }

      function loaddata() {
        let lastTasks = localStorage.getItem("saves");
        if (!lastTasks) return;
        saves = JSON.parse(lastTasks);
        saves.forEach(addContent);
      }

      let list_number = {
        Subway: 0,
        BBQ: 0,
      };
      const cost = {
        Subway: 11000,
        BBQ: 18000,
      };

      function addContent(save) {
        let tbody;
        let tr = document.createElement("tr");
        let th = document.createElement("th");
        let select = document.createElement("button");
        select.type = "button";
        select.className = "btn btn-light select";
        select.textContent = "선택";
        let td0 = document.createElement("td");
        let td1 = document.createElement("td");
        let td2 = document.createElement("td");
        let td3 = document.createElement("td");
        th.scope = "row";
        td0.textContent = save.time;
        td2.textContent = save.location;
        if (save.store === 0) {
          tbody = document.querySelector("#subway_tbody");
          list_number.Subway++;
          th.textContent = list_number.Subway;
          td1.textContent = cost.Subway - save.money + "원";
        }
        if (save.store === 1) {
          tbody = document.querySelector("#bbq_tbody");
          list_number.BBQ++;
          th.textContent = list_number.BBQ;
          td1.textContent = cost.BBQ - save.money + "원";
        }
        tr.appendChild(th);
        tr.appendChild(td0);
        tr.appendChild(td1);
        tr.appendChild(td2);
        tr.appendChild(td3);
        td3.appendChild(select);
        tbody.appendChild(tr);
      }

      let submit = document.querySelector("#submit");
      submit.addEventListener("click", () => {
        (function () {
          "use strict";

          var forms = document.querySelectorAll(".needs-validation");

          Array.prototype.slice.call(forms).forEach(function (form) {
            form.addEventListener(
              "submit",
              function (event) {
                event.preventDefault();
                event.stopPropagation();
                form.classList.add("was-validated");

                if (form.checkValidity()) {
                  //if subway
                  let store = document.querySelector("#ordered_store");
                  let time = document.querySelector("#ordered_time");
                  let money = document.querySelector("#ordered_money");
                  let location = document.querySelector("#ordered_location");
                  let save;
                  if (store.value === "써브웨이") {
                    save = {
                      store: type.Subway,
                      time: time.value,
                      money: money.value,
                      location: location.value,
                    };
                  }
                  if (store.value === "BBQ") {
                    save = {
                      store: type.BBQ,
                      time: time.value,
                      money: money.value,
                      location: location.value,
                    };
                  }
                  saves.push(save);
                  savedata();
                  addContent(save);
                  time.value = "";
                  money.value = "";
                  location.value = "";
                }
              },
              false
            );
          });
        })();
      });
    </script>
  </body>
</html>
